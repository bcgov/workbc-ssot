load csv
    from 'census.csv'
    (
        noc,
        description,
        workers_employed,
        workers_full_time,
        employment_by_gender_men,
        employment_by_gender_women,
        employment_by_age_group_15_24,
        employment_by_age_group_25_44,
        employment_by_age_group_45_64,
        employment_by_age_group_65,
        cariboo_employment_of_this_occupation,
        cariboo_employment_of_all_occupations,
        kootenay_employment_of_this_occupation,
        kootenay_employment_of_all_occupations,
        mainland_southwest_employment_of_this_occupation,
        mainland_southwest_employment_of_all_occupations,
        north_coast_nechako_employment_of_this_occupation,
        north_coast_nechako_employment_of_all_occupations,
        northeast_employment_of_this_occupation,
        northeast_employment_of_all_occupations,
        thompson_okanagan_employment_of_this_occupation,
        thompson_okanagan_employment_of_all_occupations,
        vancouver_island_coast_employment_of_this_occupation,
        vancouver_island_coast_employment_of_all_occupations,
        industry_1_name,
        industry_1,
        industry_2_name,
        industry_2,
        industry_3_name,
        industry_3,
        industry_4_name,
        industry_4,
        industry_5_name,
        industry_5
    )
    into postgresql:///ssot
    target table census
    target columns
    (
        noc text using (trim-hash noc),
        description,
        workers_employed int using (not-available-to-null workers_employed),
        workers_full_time numeric using (not-available-to-null workers_full_time),
        employment_by_gender_men numeric using (not-available-to-null employment_by_gender_men),
        employment_by_gender_women numeric using (not-available-to-null employment_by_gender_women),
        employment_by_age_group_15_24 numeric using (not-available-to-null employment_by_age_group_15_24),
        employment_by_age_group_25_44 numeric using (not-available-to-null employment_by_age_group_25_44),
        employment_by_age_group_45_64 numeric using (not-available-to-null employment_by_age_group_45_64),
        employment_by_age_group_65 numeric using (not-available-to-null employment_by_age_group_65),
        cariboo_employment_of_this_occupation numeric using (not-available-to-null cariboo_employment_of_this_occupation),
        cariboo_employment_of_all_occupations numeric using (not-available-to-null cariboo_employment_of_all_occupations),
        kootenay_employment_of_this_occupation numeric using (not-available-to-null kootenay_employment_of_this_occupation),
        kootenay_employment_of_all_occupations numeric using (not-available-to-null kootenay_employment_of_all_occupations),
        mainland_southwest_employment_of_this_occupation numeric using (not-available-to-null mainland_southwest_employment_of_this_occupation),
        mainland_southwest_employment_of_all_occupations numeric using (not-available-to-null mainland_southwest_employment_of_all_occupations),
        north_coast_nechako_employment_of_this_occupation numeric using (not-available-to-null north_coast_nechako_employment_of_this_occupation),
        north_coast_nechako_employment_of_all_occupations numeric using (not-available-to-null north_coast_nechako_employment_of_all_occupations),
        northeast_employment_of_this_occupation numeric using (not-available-to-null northeast_employment_of_this_occupation),
        northeast_employment_of_all_occupations numeric using (not-available-to-null northeast_employment_of_all_occupations),
        thompson_okanagan_employment_of_this_occupation numeric using (not-available-to-null thompson_okanagan_employment_of_this_occupation),
        thompson_okanagan_employment_of_all_occupations numeric using (not-available-to-null thompson_okanagan_employment_of_all_occupations),
        vancouver_island_coast_employment_of_this_occupation numeric using (not-available-to-null vancouver_island_coast_employment_of_this_occupation),
        vancouver_island_coast_employment_of_all_occupations numeric using (not-available-to-null vancouver_island_coast_employment_of_all_occupations),
        industry_1_name,
        industry_1 numeric using (not-available-to-null industry_1),
        industry_2_name,
        industry_2 numeric using (not-available-to-null industry_2),
        industry_3_name,
        industry_3 numeric using (not-available-to-null industry_3),
        industry_4_name,
        industry_4 numeric using (not-available-to-null industry_4),
        industry_5_name,
        industry_5 numeric using (not-available-to-null industry_5)
    )
    with
        skip header = 4,
        fields optionally enclosed by '"',
        fields terminated by ',',
        drop indexes

    before load do
    $$ drop table if exists census; $$,
    $$ create table if not exists census
    (
        noc text primary key,
        description text,
        workers_employed int,
        workers_full_time numeric,
        employment_by_gender_men numeric,
        employment_by_gender_women numeric,
        employment_by_age_group_15_24 numeric,
        employment_by_age_group_25_44 numeric,
        employment_by_age_group_45_64 numeric,
        employment_by_age_group_65 numeric,
        cariboo_employment_of_this_occupation numeric,
        cariboo_employment_of_all_occupations numeric,
        kootenay_employment_of_this_occupation numeric,
        kootenay_employment_of_all_occupations numeric,
        mainland_southwest_employment_of_this_occupation numeric,
        mainland_southwest_employment_of_all_occupations numeric,
        north_coast_nechako_employment_of_this_occupation numeric,
        north_coast_nechako_employment_of_all_occupations numeric,
        northeast_employment_of_this_occupation numeric,
        northeast_employment_of_all_occupations numeric,
        thompson_okanagan_employment_of_this_occupation numeric,
        thompson_okanagan_employment_of_all_occupations numeric,
        vancouver_island_coast_employment_of_this_occupation numeric,
        vancouver_island_coast_employment_of_all_occupations numeric,
        industry_1_name text,
        industry_1 numeric,
        industry_2_name text,
        industry_2 numeric,
        industry_3_name text,
        industry_3 numeric,
        industry_4_name text,
        industry_4 numeric,
        industry_5_name text,
        industry_5 numeric
    );
    $$

    after load do
    $$ with s as (
            select * from census where noc = '0011'
        )
        update census set
            cariboo_employment_of_all_occupations = s.cariboo_employment_of_all_occupations,
            kootenay_employment_of_all_occupations = s.kootenay_employment_of_all_occupations,
            mainland_southwest_employment_of_all_occupations = s.mainland_southwest_employment_of_all_occupations,
            north_coast_nechako_employment_of_all_occupations = s.north_coast_nechako_employment_of_all_occupations,
            northeast_employment_of_all_occupations = s.northeast_employment_of_all_occupations,
            thompson_okanagan_employment_of_all_occupations = s.thompson_okanagan_employment_of_all_occupations,
            vancouver_island_coast_employment_of_all_occupations = s.vancouver_island_coast_employment_of_all_occupations
        from s;
    $$,
    $$ comment on table census is '2016 Census > Career Profiles'; $$,
    $$ comment on column census.noc is 'NOC'; $$,
    $$ comment on column census.description is 'Description'; $$,
    $$ comment on column census.workers_employed is 'Workforce characteristics > workers are employed'; $$,
    $$ comment on column census.workers_full_time is 'Workforce characteristics > of workers are working mostly full time (%)'; $$,
    $$ comment on column census.employment_by_gender_men is 'Employment by gender (%) > Men'; $$,
    $$ comment on column census.employment_by_gender_women is 'Employment by gender (%) > Women'; $$,
    $$ comment on column census.employment_by_age_group_15_24 is 'Employment by age group (%) > 15-24'; $$,
    $$ comment on column census.employment_by_age_group_25_44 is 'Employment by age group (%) > 25-44'; $$,
    $$ comment on column census.employment_by_age_group_45_64 is 'Employment by age group (%) > 45-64'; $$,
    $$ comment on column census.employment_by_age_group_65 is 'Employment by age group (%) > 65+'; $$,
    $$ comment on column census.cariboo_employment_of_this_occupation is 'Cariboo > % employment of this occupation'; $$,
    $$ comment on column census.cariboo_employment_of_all_occupations is 'Cariboo > % employment of all occupations'; $$,
    $$ comment on column census.kootenay_employment_of_this_occupation is 'Kootenay > % employment of this occupation'; $$,
    $$ comment on column census.kootenay_employment_of_all_occupations is 'Kootenay > % employment of all occupations'; $$,
    $$ comment on column census.mainland_southwest_employment_of_this_occupation is 'Mainland/Southwest > % employment of this occupation'; $$,
    $$ comment on column census.mainland_southwest_employment_of_all_occupations is 'Mainland/Southwest > % employment of all occupations'; $$,
    $$ comment on column census.north_coast_nechako_employment_of_this_occupation is 'North Coast & Nechako > % employment of this occupation'; $$,
    $$ comment on column census.north_coast_nechako_employment_of_all_occupations is 'North Coast & Nechako > % employment of all occupations'; $$,
    $$ comment on column census.northeast_employment_of_this_occupation is 'Northeast > % employment of this occupation'; $$,
    $$ comment on column census.northeast_employment_of_all_occupations is 'Northeast > % employment of all occupations'; $$,
    $$ comment on column census.thompson_okanagan_employment_of_this_occupation is 'Thompson-Okanagan > % employment of this occupation'; $$,
    $$ comment on column census.thompson_okanagan_employment_of_all_occupations is 'Thompson-Okanagan > % employment of all occupations'; $$,
    $$ comment on column census.vancouver_island_coast_employment_of_this_occupation is 'Vancouver Island/Coast > % employment of this occupation'; $$,
    $$ comment on column census.vancouver_island_coast_employment_of_all_occupations is 'Vancouver Island/Coast > % employment of all occupations'; $$,
    $$ comment on column census.industry_1_name is 'Industry 1 > Name'; $$,
    $$ comment on column census.industry_1 is 'Industry 1 > %'; $$,
    $$ comment on column census.industry_2_name is 'Industry 2 > Name'; $$,
    $$ comment on column census.industry_2 is 'Industry 2 > %'; $$,
    $$ comment on column census.industry_3_name is 'Industry 3 > Name'; $$,
    $$ comment on column census.industry_3 is 'Industry 3 > %'; $$,
    $$ comment on column census.industry_4_name is 'Industry 4 > Name'; $$,
    $$ comment on column census.industry_4 is 'Industry 4 > %'; $$,
    $$ comment on column census.industry_5_name is 'Industry 5 > Name'; $$,
    $$ comment on column census.industry_5 is 'Industry 5 > %'; $$
;
